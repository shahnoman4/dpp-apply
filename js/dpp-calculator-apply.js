
  // Run Calculations
    


  var year2019 = {
    "tier" :[
      {
        "_comment": "TIER 1",
        "household" : [
          {"household_rating":16460},
          {"household_rating":20780},
          {"household_rating":25100},
          {"household_rating":29420},
          {"household_rating":33740},
          {"household_rating":38060},
          {"household_rating":42380}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 527, "half": 264, "extended" : 606},
          {"rating":2, "full": 587, "half": 294, "extended" : 675},
          {"rating":3, "full": 678, "half": 339, "extended" : 779},
          {"rating":4, "full": 715, "half": 358, "extended" : 823},
          {"rating":5, "full": 789, "half": 394, "extended" : 907}
        ]
      },
      {
        "_comment": "TIER 2",
        "household" : [
          {"household_rating":30451},
          {"household_rating":38443},
          {"household_rating":46435},
          {"household_rating":54427},
          {"household_rating":62419},
          {"household_rating":70411},
          {"household_rating":78403}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 474, "half": 237, "extended" : 545},
          {"rating":2, "full": 529, "half": 264, "extended" : 608},
          {"rating":3, "full": 610, "half": 305, "extended" : 701},
          {"rating":4, "full": 644, "half": 322, "extended" : 740},
          {"rating":5, "full": 710, "half": 355, "extended" : 817}
        ]
      },
      {
        "_comment": "TIER 3",
        "household" : [
          {"household_rating":49380},
          {"household_rating":62340},
          {"household_rating":75300},
          {"household_rating":88260},
          {"household_rating":101220},
          {"household_rating":114180},
          {"household_rating":127140}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 448, "half": 224, "extended" : 515},
          {"rating":2, "full": 499, "half": 250, "extended" : 574},
          {"rating":3, "full": 576, "half": 288, "extended" : 662},
          {"rating":4, "full": 608, "half": 304, "extended" : 699},
          {"rating":5, "full": 671, "half": 335, "extended" : 771}
        ]
      },
      {
        "_comment": "TIER 4",
        "household" : [
          {"household_rating":65840},
          {"household_rating":83120},
          {"household_rating":100400},
          {"household_rating":117680},
          {"household_rating":134960},
          {"household_rating":152240},
          {"household_rating":169520}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 369, "half": 184, "extended" : 424},
          {"rating":2, "full": 411, "half": 206, "extended" : 473},
          {"rating":3, "full": 474, "half": 237, "extended" : 545},
          {"rating":4, "full": 501, "half": 250, "extended" : 576},
          {"rating":5, "full": 552, "half": 276, "extended" : 635}
        ]
      },
      {
        "_comment": "TIER 5",
        "household" : [
          {"household_rating":65840},
          {"household_rating":83120},
          {"household_rating":100400},
          {"household_rating":117680},
          {"household_rating":134960},
          {"household_rating":152240},
          {"household_rating":169520}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 105, "half": 53, "extended" : 121},
          {"rating":2, "full": 117, "half": 59, "extended" : 135},
          {"rating":3, "full": 136, "half": 68, "extended" : 156},
          {"rating":4, "full": 143, "half": 72, "extended" : 165},
          {"rating":5, "full": 158, "half": 79, "extended" : 181}
        ]
      }
    ]
  };

  var year2020 = {
    "tier" :[
      {
        "_comment": "TIER 1",
        "household" : [
          {"household_rating":16460},
          {"household_rating":20780},
          {"household_rating":25100},
          {"household_rating":29420},
          {"household_rating":33740},
          {"household_rating":38060},
          {"household_rating":42380}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 527, "half": 264, "extended" : 606},
          {"rating":2, "full": 587, "half": 294, "extended" : 675},
          {"rating":3, "full": 678, "half": 339, "extended" : 779},
          {"rating":4, "full": 715, "half": 358, "extended" : 823},
          {"rating":5, "full": 789, "half": 394, "extended" : 907}
        ]
      },
      {
        "_comment": "TIER 2",
        "household" : [
          {"household_rating":30451},
          {"household_rating":38443},
          {"household_rating":46435},
          {"household_rating":54427},
          {"household_rating":62419},
          {"household_rating":70411},
          {"household_rating":78403}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 474, "half": 237, "extended" : 545},
          {"rating":2, "full": 529, "half": 264, "extended" : 608},
          {"rating":3, "full": 610, "half": 305, "extended" : 701},
          {"rating":4, "full": 644, "half": 322, "extended" : 740},
          {"rating":5, "full": 710, "half": 355, "extended" : 817}
        ]
      },
      {
        "_comment": "TIER 3",
        "household" : [
          {"household_rating":49380},
          {"household_rating":62340},
          {"household_rating":75300},
          {"household_rating":88260},
          {"household_rating":101220},
          {"household_rating":114180},
          {"household_rating":127140}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 448, "half": 224, "extended" : 515},
          {"rating":2, "full": 499, "half": 250, "extended" : 574},
          {"rating":3, "full": 576, "half": 288, "extended" : 662},
          {"rating":4, "full": 608, "half": 304, "extended" : 699},
          {"rating":5, "full": 671, "half": 335, "extended" : 771}
        ]
      },
      {
        "_comment": "TIER 4",
        "household" : [
          {"household_rating":65840},
          {"household_rating":83120},
          {"household_rating":100400},
          {"household_rating":117680},
          {"household_rating":134960},
          {"household_rating":152240},
          {"household_rating":169520}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 369, "half": 184, "extended" : 424},
          {"rating":2, "full": 411, "half": 206, "extended" : 473},
          {"rating":3, "full": 474, "half": 237, "extended" : 545},
          {"rating":4, "full": 501, "half": 250, "extended" : 576},
          {"rating":5, "full": 552, "half": 276, "extended" : 635}
        ]
      },
      {
        "_comment": "TIER 5",
        "household" : [
          {"household_rating":65840},
          {"household_rating":83120},
          {"household_rating":100400},
          {"household_rating":117680},
          {"household_rating":134960},
          {"household_rating":152240},
          {"household_rating":169520}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 105, "half": 53, "extended" : 121},
          {"rating":2, "full": 117, "half": 59, "extended" : 135},
          {"rating":3, "full": 136, "half": 68, "extended" : 156},
          {"rating":4, "full": 143, "half": 72, "extended" : 165},
          {"rating":5, "full": 158, "half": 79, "extended" : 181}
        ]
      }
    ]
  };
  
  var year2021 = {
    "tier" :[
      {
        "_comment": "TIER 1",
        "household" : [
          {"household_rating":16910},
          {"household_rating":21330},
          {"household_rating":25750},
          {"household_rating":30170},
          {"household_rating":34590},
          {"household_rating":39010},
          {"household_rating":43430}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 581, "half": 290, "extended" : 668},
          {"rating":2, "full": 647, "half": 324, "extended" : 744},
          {"rating":3, "full": 747, "half": 373, "extended" : 859},
          {"rating":4, "full": 788, "half": 394, "extended" : 906},
          {"rating":5, "full": 869, "half": 435, "extended" : 1000}
        ]
      },
      {
        "_comment": "TIER 2",
        "household" : [
          {"household_rating":31284},
          {"household_rating":39461},
          {"household_rating":47638},
          {"household_rating":55815},
          {"household_rating":63992},
          {"household_rating":72169},
          {"household_rating":80346}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 523, "half": 261, "extended" : 601},
          {"rating":2, "full": 582, "half": 291, "extended" : 670},
          {"rating":3, "full": 672, "half": 336, "extended" : 773},
          {"rating":4, "full": 709, "half": 355, "extended" : 816},
          {"rating":5, "full": 782, "half": 391, "extended" : 900}
        ]
      },
      {
        "_comment": "TIER 3",
        "household" : [
          {"household_rating":50730},
          {"household_rating":63990},
          {"household_rating":77250},
          {"household_rating":90510},
          {"household_rating":103770},
          {"household_rating":117030},
          {"household_rating":130290}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 494, "half": 247, "extended" : 568},
          {"rating":2, "full": 550, "half": 275, "extended" : 633},
          {"rating":3, "full": 635, "half": 317, "extended" : 730},
          {"rating":4, "full": 670, "half": 335, "extended" : 770},
          {"rating":5, "full": 739, "half": 369, "extended" : 850}
        ]
      },
      {
        "_comment": "TIER 4",
        "household" : [
          {"household_rating":67640},
          {"household_rating":85320},
          {"household_rating":103000},
          {"household_rating":120680},
          {"household_rating":138360},
          {"household_rating":156040},
          {"household_rating":173720}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 407, "half": 203, "extended" : 468},
          {"rating":2, "full": 453, "half": 227, "extended" : 521},
          {"rating":3, "full": 523, "half": 261, "extended" : 601},
          {"rating":4, "full": 552, "half": 276, "extended" : 635},
          {"rating":5, "full": 609, "half": 304, "extended" : 700}
        ]
      },
      {
        "_comment": "TIER 5",
        "household" : [
          {"household_rating":67640},
          {"household_rating":85320},
          {"household_rating":103000},
          {"household_rating":120680},
          {"household_rating":138360},
          {"household_rating":156040},
          {"household_rating":173720}
        ],
        "tutionCredit" : [
          {"rating":1, "full": 116, "half": 58, "extended" : 134},
          {"rating":2, "full": 129, "half": 65, "extended" : 149},
          {"rating":3, "full": 149, "half": 75, "extended" : 172},
          {"rating":4, "full": 158, "half": 79, "extended" : 181},
          {"rating":5, "full": 174, "half": 87, "extended" : 200}
        ]
      }
    ]
  };


  // Helper to set output value
  function valueOutput(element) {
    var textContent = ('textContent' in document) ? 'textContent' : 'innerText';
     var value = element.value;
     var output = element.parentNode.getElementsByTagName('output')[0] || element.parentNode.parentNode.getElementsByTagName('output')[0];
     output[textContent] = value;
   }

  // Helper to animate numbers
  function animateNumbers(id, start, end, duration) {
    var range = end - start;
    var current = start;
    var increment = end > start ? 1 : -1;
    var stepTime = Math.abs(Math.floor(duration / range));
    var obj = document.getElementById(id);
    var timer = setInterval(function () {
      current += increment;
      obj.innerHTML = current;
      if (current == end) {
        clearInterval(timer);
      }
    }, stepTime);
  }


  function setCookie(cname, cvalue) {
    var date = new Date();
    date.setTime(date.getTime()+(6*60*60*1000));
    document.cookie = cname + "=" + cvalue + ";path=/;expires="+date.toGMTString();
  }

  function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
  }

  function getCalc() {

      var school_year = '2020-2021';
      var theEstimate = parseInt($('#theEstimate').text(), 10);

      if (school_year == '2018-2019') {
        var json_file = year2019;
      }
      if (school_year == '2019-2020') {
        var json_file = year2020;
      }
      if (school_year == '2020-2021') {
        var json_file = year2021;
      }

      var family_size = parseInt($('#total_household option:selected').val(), 10);
      var school_rating = parseInt($('#preschool_name option:selected').data('rating'));
      var participation_type = $('#part_full_day option:selected').val();
      var income = $('#income').val();
      income = income.replace(/,/g, "");
      income = parseInt(income, 10) * 12;
      
      console.log(school_rating);
      console.log(family_size);
      console.log(income);
      console.log(participation_type);

      if (income <= json_file.tier[0].household[family_size - 2].household_rating) {
        if (participation_type == 'half')
            var school_r_full = json_file.tier[0].tutionCredit[school_rating - 1].half;
        else if (participation_type == 'extended')
            var school_r_full = json_file.tier[0].tutionCredit[school_rating - 1].extended;
        else
            var school_r_full = json_file.tier[0].tutionCredit[school_rating - 1].full;
        if (school_r_full == theEstimate)
          return false;
        else
          animateNumbers("theEstimate", theEstimate, school_r_full, 100);
      }
      if (income > json_file.tier[0].household[family_size - 2].household_rating && income <= json_file.tier[1].household[family_size - 2].household_rating) {
        if (participation_type == 'half')
            var school_r_full = json_file.tier[1].tutionCredit[school_rating - 1].half;
        else if (participation_type == 'extended')
            var school_r_full = json_file.tier[1].tutionCredit[school_rating - 1].extended;
        else
            var school_r_full = json_file.tier[1].tutionCredit[school_rating - 1].full;
        if (school_r_full == theEstimate)
          return false;
        else
          animateNumbers("theEstimate", theEstimate, school_r_full, 100);
      }
      if (income > json_file.tier[1].household[family_size - 2].household_rating && income <= json_file.tier[2].household[family_size - 2].household_rating) {
        if (participation_type == 'half')
            var school_r_full = json_file.tier[2].tutionCredit[school_rating - 1].half;
        else if (participation_type == 'extended')
            var school_r_full = json_file.tier[2].tutionCredit[school_rating - 1].extended;
        else
            var school_r_full = json_file.tier[2].tutionCredit[school_rating - 1].full;
        if (school_r_full == theEstimate)
          return false;
        else
          animateNumbers("theEstimate", theEstimate, school_r_full, 100);
      }
      if (income > json_file.tier[2].household[family_size - 2].household_rating && income <= json_file.tier[3].household[family_size - 2].household_rating) {
        if ( participation_type == 'half')
            var school_r_full = json_file.tier[3].tutionCredit[school_rating - 1].half;
        else if ( participation_type == 'extended')
            var school_r_full = json_file.tier[3].tutionCredit[school_rating - 1].extended;
        else
            var school_r_full = json_file.tier[3].tutionCredit[school_rating - 1].full;
        if (school_r_full == theEstimate)
          return false;
        else
          animateNumbers("theEstimate", theEstimate, school_r_full, 100);
      }
      if (income >= json_file.tier[3].household[family_size - 2].household_rating) {
        if ($('#participation_type').val() == 'half')
            var school_r_full = json_file.tier[4].tutionCredit[school_rating - 1].half;
        else if ($('#participation_type').val() == 'extended')
            var school_r_full = json_file.tier[4].tutionCredit[school_rating - 1].extended;
        else
            var school_r_full = json_file.tier[4].tutionCredit[school_rating - 1].full;
        if (school_r_full == theEstimate)
          return false;
        else
          animateNumbers("theEstimate", theEstimate, school_r_full, 100);
      }

	  return school_r_full;

    }
